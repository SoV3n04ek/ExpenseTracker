<div class="centered-container">
    <div class="card">
        <div class="text-center">
            <h2 class="mt-6">Forgot Password</h2>
            <p class="mt-2 text-muted">Enter your email and we'll send you a reset link</p>
        </div>

        @if (submitted()) {
        <div class="success-alert">
            <p><strong>Check your inbox</strong></p>
            <p>We've sent an email with instructions to reset your password. Please check your spam folder if you don't
                see it within a few minutes.</p>
        </div>

        <div class="text-center mt-6">
            <a routerLink="/login" class="success-link">Back to login</a>
        </div>
        } @else {

        @if (store.status() === 'error' && store.error()) {
        <div class="error-alert">
            @if (Array.isArray(store.error())) {
            <ul class="mb-0">
                @for (err of asArray(store.error()); track $index) {
                <li>{{ err }}</li>
                }
            </ul>
            } @else {
            <p>{{ store.error() }}</p>
            }
        </div>
        }

        <form [formGroup]="forgotForm" (ngSubmit)="onSubmit()" class="mt-8">
            <mat-form-field appearance="outline" class="w-full">
                <mat-label>Email Address</mat-label>
                <input matInput formControlName="email" type="email" placeholder="name@example.com">
                @if (forgotForm.controls.email.errors?.['required']) {
                <mat-error>Email is required</mat-error>
                } @else if (forgotForm.controls.email.errors?.['email']) {
                <mat-error>Please enter a valid email</mat-error>
                }
            </mat-form-field>

            <button mat-flat-button color="primary" type="submit" class="btn-primary mt-4"
                [disabled]="forgotForm.invalid || store.isLoading()">

                @if (store.isLoading()) {
                <span class="loading-container">
                    <span class="spinner-sm mr-2"></span>
                    Sending...
                </span>
                } @else {
                Send Reset Link
                }
            </button>

            <div class="text-center mt-6">
                <a routerLink="/login" class="success-link">Back to login</a>
            </div>
        </form>
        }
    </div>
</div>